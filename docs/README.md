# Задание 

Привет!

В рамках хакатона мы подготовили для вас [систему на кристалле](docs/SoC.MD) и [окружение для ее верификации](docs/SoC.MD#верификационное-окружение), а вам предстоит эту самую верификацию провести, причем в формате "черного ящика", когда исходный код тестируемого компонента от вас надежно спрятан.

## Как победить?

Если кратко, мы ждем от вас качественно проверифицированную систему на кристалле. Верификация подразумевает разработку тестового плана, функциональных тестов, их запуск и анализ результатов:

* [**Тестовый план**](#предлагаемый-тестовый-план). Мы заболиво предоставим вам набросок плана, который вам нужно *расширить*, основываясь на предоставленной документации. Показателем хорошего тестового плана будет, соответственно, его **полнота**.
* **Функциональные тесты**. Теперь нужно проверить всё то, что вы расписали в тестовом плане. Инструкцию к тому, как писать и запускать тесты, можно прочитать [тут](docs/TEST_GUIDELINE.MD). Оцениваться тут будет **покрытие кода** тестами.
* **Анализ результатов**. При промышленной разработке СнК сложно избежать ошибок, поэтому помимо исправной версии блока придумали вам еще 10 "сломанных" дизайнов, с уникальной ошибкой в каждом из них. В рамках этого этапа нужно будет найти все ошибки, основываясь на результатах тестов, и описать - чем же поведение очередного "сломанного" СнК отличается от ожидаемого. Например, цвет пикселей декодированной картинки отличается от референсной.

## Рекомендуемый порядок выполнения задания
### День 1
1. Запустить пример по инструкции [Первый запуск](/docs/TEST_GUIDELINE.MD#первый-запуск).
2. Ознакомиться с документацией:
    - На [СнК и карту памяти](docs/SoC.MD).
    - На подсистему "JPEG SUB" и ее составные части [DMA](docs/DMA.MD) и сам [JPEG декодер](docs/JPEG.MD).
    - На [правила разработки тестового плана и тестов](docs/TEST_GUIDELINE.MD).
3. Сформировать тестовый план на основе документации.
4. Разработать тесты для 1-4 пункта тестового плана - поиграться с регистрами и подсистемой прерываний.
5. Отправить разработанный тестовый план на проверку в соответствии с [правилами](#формат-предоставления-тестового-плана-на-проверку).

### День 2
1. Наигравшись с регистрами, разработать [E2E (End-To-End)](docs/E2E.MD) тест, проверяющий прямую задачу СнК - декодирование изображения. 
2. Разработать тесты для 5 пункта тестового плана - проверить корректность декодирования на разных картинках.
3. Разработка [конвертера BGR->BMP](#разработка-конвертера-день-2)
4. Анализ кодового покрытия, доработка тестового плана для достижения показателя кодового покрытия 100% (близок локоток, да не дотянется роток).

### День 3
1. [Поиск и анализ ошибок в сломанных дизайнах](#поиск-ошибок-в-дизайнах-день-2-3).
2. Сформировать отчет о результатах верификации.


## Предлагаемый тестовый план
1. Проверка доступа к адресному пространству подсистемы "JPEG SUB".
2. Проверка регистров подсистемы на соответствие документации: значения  по умолчанию, корректность квалификаторов доступа RO, RW, WO.
3. Проверка корректности работы подсистемы в составе СнК в режиме опроса (polling).
4. Проверка корректности работы подсистемы в составе СнК в режиме работы с прерываниями (interrupt).
5. Проверка тестов покрывающих фичи JPEG:
    - Корретность декодирования изображения разного размера.
    - Корретность декодирования цветного и черно-белого изображения.
    - Корректность декодирования метаинформации JPEG изображения. 

## Формат предоставления тестового плана на проверку

Несмотря на то, что мы предоставили его вам в обычном текстовом виде, вам нужно будет перевести его в более формальный вид средствами RobotFramework. Что это такое - можно кратенько прочитать в интернете.\
Необходимо зайти в файл /snapshot/design0/design0.robot и в соответствии с форматом, описанным в [гайде](/docs/TEST_GUIDELINE.MD#запуск-теста) насоздавать ряд Test Case'ов с ключевым словом Skip, и в раздел [Documentation] к каждому из них описать, что именно будет проверять этот тест, например:

```
*** Test Cases ***
Register test
    [Documentation]    Проверка доступа к адресному пространству подсистемы "JPEG SUB".
    Skip
    ${RESULT} =    Run Test    jpeg_test    img
    ${EXPECTED} =    Set Variable    0
```

Да, на этом этапе у вас еще нет написанных тестов и запускать ничего не нужно.

Как напишете, просто запушьте изменения в ваш репозиторий на гитлабе, там автоматически сформируется красивый отчет, который мы и оценим.

## Разработка конвертера (день 2)

**Что это?** - функция, конвертирующая файл в формате BGR888 в формат BMP

**Зачем?** - вдоволь наигравшись с регистрами, вам предстоит проверить, а как декодер справляется со своей прямой задачей (Подсказки, кстати, описаны в [E2E](docs/E2E.MD)). Когда вы разберетесь, как и где забрать у декодера выходную картинку, она будет представлена, ожидаемо, в формате BGR888. Побайтово сравнив результат с референсным файлом (который мы бережно положили в директорию bgr), вы не встретите ошибок, т.к. пока еще работаете с эталонным дизайном. Но когда вы начнете искать баги в "сломанных" дизайнах, будет очень важно оценить выходную картинку не только побайтово, но и визуально. Но проблема в том, что "сырой" формат BGR888 нельзя отобразить базовыми средствами вашей ОС. Обидно, да? Поэтому тут мы предлагаем вам написать коротенькую функцию на Си (заготовка для которой лежит в /src/converter.c), переводящую файл в отображаемый формат, а именно - BMP.

**А как?** - а вот [так](docs/CONVERTER.MD).


## Поиск ошибок в дизайнах (день 2-3)

Поздравляем! Вы добрались до самого интересного.
Как упоминалось выше, мы подготовили для вас ряд "сломанных" дизайнов, пронумеровали и сложили в папочку *snapshot*. 

design0 - эталонный, т.е. ошибки мы в него намеренно не вкладывали. \
Остальные - с уникальными ошибками, которые вам и придется найти. 

**Как искать?** 
тестами.\
Надеемся вы прошли путь война, описанный [в гайдлайне](docs/TEST_GUIDELINE.MD) и уже имеете ряд тестов, в том числе E2E. Прогоните их по всем дизайнам, и скорее всего сразу же сможете разгадать парочку багов. \
Дальше - внимательно перечитывать документацию и подозревать буквально каждый пунктик - но ошибки там не душные, честно. Помните, что баги могут проявляться не на любой картинке...


## Cтруктура репо
```
├── asm*            // Служебная директория с асм файлами
├── bgr             // Рефернсные изображения в формате bgr
├── docs*           // Документация
│   └── images
├── img             // Тестовые изображения в формате JPEG
├── ld              // Служебные линкер скрипты 
├── snapshot        // Собранные RTL дизайны
│   ├── design0     // Эталонный дизайн 
│   ├── design1     // Сломанный дизайн 1
│   ├── design2     // Сломанный дизайн 2
│   ├── design3     // Сломанный дизайн 3
│   ├── design4     // Сломанный дизайн 4
│   ├── design5     // Сломанный дизайн 5
│   ├── design6     // Сломанный дизайн 6
│   ├── design7     // Сломанный дизайн 7
│   ├── design8     // Сломанный дизайн 8
│   ├── design9     // Сломанный дизайн 9
│   └── design10    // Сломанный дизайн 10
├── include         // Общие .h файлы для всех тестов
├── src             // Общие .с файлы для всех тестов
└── test            // Файлы исходников тестов

Папки помеченные * модифицировать не нужно
```
