# Описание JPEG

*JPEG decoder* - основной функциональный блок нашей СнК, который выполняет алгоритм декодирования изображения в формате JPEG в формат BGR888 (сырые rgb пиксели представленные в последовательном формате). Стандарт входного JPEG ISO/IEC 10918-1.

##  Поддерживаемая функциональность блока

1. Декодирование baseline JPEG изображений.
2. Максимальное разрешение входного изображения fullHD (1920x1080).
3. Автоматическая обработка метаинформаиции JPEG.
    + Поддержка DRI метки и соответствующих ей rst маркеров.
    + Поддержка комментариев.
    + Поддержка экранирования символов FF00.
4. Поддержка режимов цветовой субдискретизации:
    - YCbCr 4:4:4,  
    - YCbCr 4:2:2H
    - YCbCr 4:2:2V
    - монохром черно-белый.
6. Программный сброс блока.

## Ограничения

1. Декодирование прогрессивного JPEG производится только по первому слою.
2. Декодирование изображения с ошибками в кадрах не поддерживаются.
3. Возможность декодировать изображение содержащиее до 4 таблиц Huffman.
4. Размеры изображения должны быть кратны 4 пикселям.

## Программная модель

Подача картинки на JPEG decoder осуществляется потоковым AXI-Stream интерфейсом.
Для того, чтобы не пришлось вручную подавать всё изображение на этот блок, к нему подключен DMA. Для декодирования изображения необходимо:
1. Снять сигнал сброса с JPEG и передать базовый адрес, по которому необходимо разместить картинку (pSocAxilOutBuffer).
2. Сконфигурировать DMA (подробнее смотреть в [DMA](DMA.MD) и [E2E](E2E.MD)).
3. Дождаться прерывания, сообщающее об окончании работы декодера.

## Карта регистров 

|   |   |   |   |   |   |   |
|---|---|---|---|---|---|---|
|Название регистра|Смещение|Название бита|Номер бита|Режим доступа|Значение сброса|Описание|
|Status|0x0|||||Регистр для мониторинга состояния блока декодера.|
|||Idle|0|r|1|0: декодер работает. 1: декодер в начальном состоянии|
|||Progressive|8|r|0|0: картинка baseline. 1: картинка progressive|
|||Reset|31|rw|1|0: декодер не сброшен. 1: декодер под сигналом сброса.|
|Size|0x4|||||Размер переданной картинки.|
|||Width|15:0|r|0|Горизонтальный размер картинки в пикселях.|
|||Height|31:16|r|0|Вертикальный размер картинки в пикселях.|
|Pixel count|0x8|||||Позиция текущего обрабатываемого пикселя.|
|||PixelX|15:0|r|0|Позиция обрабатываемого пикселя по горизонтали.|
|||PixelY|31:16|r|0|Позиция обрабатываемого пикселя по вертикали.|
|Version|0x10|Version|31:0|r|0x42|Версия блока декодера.|
|Base address|0x14|Base addr|31:0|w|0|Базовый адрес для записи выходной картинки.|
